---
- name: Get Kube Bench Results
  hosts: '*'
  tasks:
  - name: Run kube-bench
    become: true
    ansible.builtin.command: kube-bench --json --outputfile=/tmp/kube-bench-report.json  --exit-code=1 --alsologtostderr -v=4
    register: benchmarks
    changed_when: false

  - name: Copy kube-bench-report
    ansible.builtin.fetch:
      src: /tmp/kube-bench-report.json
      dest: ~/kube-bench/
      mode: 0600
